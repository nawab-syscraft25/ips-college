{% extends "base.html" %}

{% block content %}
<style>
  .page-filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    align-items: center;
  }
  
  .page-filters input,
  .page-filters select {
    padding: 0.625rem 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    font-size: 0.875rem;
  }
  
  .page-view-toggle {
    display: flex;
    gap: 0.5rem;
    margin-left: auto;
  }
  
  .view-btn {
    padding: 0.5rem 0.75rem;
    border: 1px solid #e5e7eb;
    background: white;
    cursor: pointer;
    border-radius: 0.375rem;
    transition: all 0.2s;
  }
  
  .view-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }
  
  .page-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 0.75rem;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  
  .page-table thead {
    background: var(--light);
    border-bottom: 2px solid #e5e7eb;
  }
  
  .page-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--dark);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .page-table td {
    padding: 1rem;
    border-bottom: 1px solid #e5e7eb;
  }
  
  .page-table tbody tr:hover {
    background: #f9fafb;
  }
  
  .page-status {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }
  
  .status-published {
    background: #dcfce7;
    color: #166534;
  }
  
  .status-draft {
    background: #fef3c7;
    color: #92400e;
  }
  
  .page-actions-cell {
    display: flex;
    gap: 0.5rem;
  }
  
  .action-btn {
    padding: 0.5rem 0.75rem;
    font-size: 0.75rem;
    border: 1px solid #e5e7eb;
    background: white;
    color: var(--primary);
    border-radius: 0.375rem;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .action-btn:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }
  
  .action-btn.delete {
    color: var(--danger);
    border-color: var(--danger);
  }
  
  .action-btn.delete:hover {
    background: var(--danger);
    color: white;
    border-color: var(--danger);
  }
  
  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
  }
  
  .empty-state-icon {
    font-size: 3rem;
    color: #d1d5db;
    margin-bottom: 1rem;
  }
  
  .empty-state-text {
    color: #6b7280;
    font-size: 1.125rem;
    margin-bottom: 1.5rem;
  }
</style>

<!-- Alert if no college selected -->
{% if not selected_college_id %}
<div class="alert-info">
  <i class="fas fa-info-circle"></i> 
  <strong>Select a college</strong> from the dropdown at the top to manage pages for that college.
</div>
{% endif %}

<!-- Page Filters & View Toggle -->
<div class="page-filters">
  <input type="text" id="searchPages" placeholder="ðŸ” Search pages..." style="flex: 1; min-width: 250px;">
  <select id="filterStatus" style="min-width: 150px;">
    <option value="">All Status</option>
    <option value="published">Published Only</option>
    <option value="draft">Drafts Only</option>
  </select>
  <div class="page-view-toggle">
    <button class="view-btn active" data-view="table" title="Table View">
      <i class="fas fa-table"></i>
    </button>
    <button class="view-btn" data-view="grid" title="Grid View">
      <i class="fas fa-th"></i>
    </button>
  </div>
</div>

<!-- Add New Page Button -->
<div style="margin-bottom: 1.5rem;">
  {% if selected_college_id %}
  <a href="/admin/page/new?college_id={{ selected_college_id }}" class="btn-primary-custom">
    <i class="fas fa-plus"></i> New Page
  </a>
  {% else %}
  <button class="btn-primary-custom" disabled title="Select a college first">
    <i class="fas fa-plus"></i> New Page
  </button>
  {% endif %}
</div>

<!-- Pages Table View -->
<div id="tableView">
  {% if pages %}
  <table class="page-table">
    <thead>
      <tr>
        <th>Page Title</th>
        <th>Slug</th>
        <th>Status</th>
        <th>Sections</th>
        <th>Last Modified</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for page in pages %}
      <tr class="page-row" data-status="{{ 'published' if page.is_active else 'draft' }}">
        <td>
          <strong>{{ page.title }}</strong>
          {% if page.parent_page_id %}<br><small style="color: #6b7280;">â†³ Inherited from parent</small>{% endif %}
        </td>
        <td><code style="background: var(--light); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.875rem;">{{ page.slug }}</code></td>
        <td>
          <span class="page-status {{ 'status-published' if page.is_active else 'status-draft' }}">
            {{ 'Published' if page.is_active else 'Draft' }}
          </span>
        </td>
        <td>{{ page.sections|length }} sections</td>
        <td><small style="color: #6b7280;">{{ page.updated_at.strftime('%b %d, %Y') if page.updated_at else 'N/A' }}</small></td>
        <td>
          <div class="page-actions-cell">
            <a href="/admin/page/{{ page.id }}/design?college_id={{ selected_college_id }}" class="action-btn" title="Design/Edit">
              <i class="fas fa-edit"></i> Design
            </a>
            <a href="/admin/page/{{ page.id }}/seo?college_id={{ selected_college_id }}" class="action-btn" title="SEO Settings">
              <i class="fas fa-search"></i> SEO
            </a>
            <a href="/admin/page/{{ page.id }}/delete?college_id={{ selected_college_id }}" class="action-btn delete" onclick="return confirm('Delete this page?')" title="Delete">
              <i class="fas fa-trash"></i>
            </a>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="empty-state">
    <div class="empty-state-icon">
      <i class="fas fa-file-alt"></i>
    </div>
    <div class="empty-state-text">No pages yet</div>
    <p style="color: #6b7280;">Create your first page to get started designing your college website.</p>
    {% if selected_college_id %}
    <a href="/admin/page/new?college_id={{ selected_college_id }}" class="btn-primary-custom">
      <i class="fas fa-plus"></i> Create First Page
    </a>
    {% else %}
    <p style="color: #ef4444; font-size: 0.875rem;">Select a college to create pages.</p>
    {% endif %}
  </div>
  {% endif %}
</div>

<!-- Pages Grid View -->
<div id="gridView" style="display: none;">
  {% if pages %}
  <div class="page-list">
    {% for page in pages %}
    <div class="page-card">
      <div class="page-card-header">
        <h3 class="page-card-title">{{ page.title }}</h3>
        <span class="page-card-badge">
          {{ 'Published' if page.is_active else 'Draft' }}
        </span>
      </div>
      <div class="page-card-meta">
        <div><code style="background: var(--light); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">{{ page.slug }}</code></div>
        <div style="margin-top: 0.5rem;">
          {{ page.sections|length }} sections â€¢ 
          {% if page.updated_at %}{{ page.updated_at.strftime('%b %d') }}{% else %}Not saved{% endif %}
        </div>
      </div>
      <div class="page-card-actions">
        <a href="/admin/page/{{ page.id }}/design?college_id={{ selected_college_id }}" class="action-btn">
          <i class="fas fa-edit"></i> Design
        </a>
        <a href="/admin/page/{{ page.id }}/seo?college_id={{ selected_college_id }}" class="action-btn">
          <i class="fas fa-search"></i> SEO
        </a>
        <a href="/admin/page/{{ page.id }}/delete?college_id={{ selected_college_id }}" class="action-btn delete" onclick="return confirm('Delete?')">
          <i class="fas fa-trash"></i>
        </a>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>

<script>
  // View toggle
  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      
      const view = this.dataset.view;
      document.getElementById('tableView').style.display = view === 'table' ? 'block' : 'none';
      document.getElementById('gridView').style.display = view === 'grid' ? 'block' : 'none';
    });
  });
  
  // Search filter
  document.getElementById('searchPages')?.addEventListener('input', function() {
    const search = this.value.toLowerCase();
    document.querySelectorAll('.page-row').forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(search) ? '' : 'none';
    });
  });
  
  // Status filter
  document.getElementById('filterStatus')?.addEventListener('change', function() {
    const status = this.value;
    document.querySelectorAll('.page-row').forEach(row => {
      const rowStatus = row.dataset.status;
      row.style.display = !status || rowStatus === status ? '' : 'none';
    });
  });
</script>
{% endblock %}
