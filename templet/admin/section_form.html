{% extends "base.html" %}
{% block content %}
<style>
  .section-form {
    background: white;
    border-radius: 0.75rem;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .form-section {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #e5e7eb;
  }
  
  .form-section:last-of-type {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }
  
  .form-section-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--dark);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .type-specific-fields {
    background: #f9fafb;
    border-left: 4px solid var(--primary);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-top: 1.5rem;
  }
  
  .image-preview {
    max-width: 100%;
    max-height: 200px;
    border-radius: 0.5rem;
    margin-top: 0.5rem;
  }
  
  .btn-group-custom {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
</style>

<h1 class="mb-4">{{ 'Edit' if action == 'edit' else 'Add' }} Section ‚Äî {{ page.title }}</h1>

<form method="post" action="{% if action == 'edit' %}/admin/pages/{{ page.id }}/sections/{{ section.id }}/edit{% else %}/admin/pages/{{ page.id }}/sections/new{% endif %}" enctype="multipart/form-data" class="section-form">
  
  <!-- Basic Section Info -->
  <div class="form-section">
    <div class="form-section-title">
      <i class="fas fa-info-circle"></i> Basic Information
    </div>
    
    <div class="row">
      <div class="col-md-8">
        <div class="mb-3">
          <label class="form-label">Section Title</label>
          <input name="section_title" class="form-control" placeholder="e.g., Welcome to our campus" value="{{ section.section_title if section else '' }}">
        </div>
        <div class="mb-3">
          <label class="form-label">Section Subtitle</label>
          <input name="section_subtitle" class="form-control" placeholder="Short subtitle (max 255 chars)" value="{{ section.section_subtitle if section else '' }}">
        </div>
        <div class="mb-3">
          <label class="form-label">Section Description</label>
          <textarea name="section_description" class="form-control" rows="5" placeholder="Longer description / body text (use this for rich content)">{{ section.section_description if section else '' }}</textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Optional Link</label>
          <input name="section_link" class="form-control" placeholder="Optional URL (e.g. /about-us or https://...)" value="{{ section.section_link if section and section.section_link else (section.extra_data.get('link') if section and section.extra_data else '') }}">
        </div>
      </div>
      <div class="col-md-4">
        <div class="mb-3">
          <label class="form-label">Section Type</label>
          <select name="section_type" id="sectionType" class="form-select" onchange="updateTypeFields()">
            {% set current_type = section.section_type if section else 'HERO' %}
            <option value="HERO" {% if current_type == 'HERO' %}selected{% endif %}>üñºÔ∏è Hero</option>
            <option value="TEXT" {% if current_type == 'TEXT' %}selected{% endif %}>üìù Text / Content</option>
            <option value="ABOUT" {% if current_type == 'ABOUT' %}selected{% endif %}>‚ÑπÔ∏è About</option>
            <option value="STATS" {% if current_type == 'STATS' %}selected{% endif %}>üìä Statistics</option>
            <option value="CARDS" {% if current_type == 'CARDS' %}selected{% endif %}>üé¥ Cards / Grid</option>
            <option value="COURSES" {% if current_type == 'COURSES' %}selected{% endif %}>üìö Courses</option>
            <option value="FACULTY" {% if current_type == 'FACULTY' %}selected{% endif %}>üë• Faculty</option>
            <option value="FACILITIES" {% if current_type == 'FACILITIES' %}selected{% endif %}>üè¢ Facilities</option>
            <option value="PLACEMENTS" {% if current_type == 'PLACEMENTS' %}selected{% endif %}>ü§ù Placements</option>
            <option value="FAQ" {% if current_type == 'FAQ' %}selected{% endif %}>‚ùì FAQ</option>
            <option value="FORM" {% if current_type == 'FORM' %}selected{% endif %}>üìã Form</option>
            <option value="TESTIMONIALS" {% if current_type == 'TESTIMONIALS' %}selected{% endif %}>üí¨ Testimonials</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- HERO Section Specific Fields -->
  <div id="heroFields" class="form-section" style="display: none;">
    <div class="form-section-title">
      <i class="fas fa-image"></i> Hero Section Settings
    </div>

    <div class="type-specific-fields">
      <div class="mb-3">
        <label class="form-label">Upload Hero Image</label>
        <input type="file" name="hero_image" class="form-control" accept="image/*" onchange="previewHeroImage(event)">
        <small class="form-text text-muted">Upload a hero image (JPG, PNG, WebP supported)</small>
        <div id="heroImagePreview">
          {% if section and section.hero_images and section.hero_images|length > 0 %}
          <div style="margin-top: 1rem;">
            <small class="text-muted">Current image:</small><br>
            <img src="{{ section.hero_images[0] }}" alt="Current hero image" class="image-preview" style="max-width: 300px; margin-top: 0.5rem; border-radius: 0.5rem; border: 1px solid #e5e7eb;">
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Settings -->
  <div class="form-section">
    <div class="form-section-title">
      <i class="fas fa-cog"></i> Settings
    </div>
    
    <div class="row">
      <div class="col-md-4">
        <div class="mb-3">
          <label class="form-label">Sort Order</label>
          <input type="number" name="sort_order" class="form-control" value="{{ section.sort_order if section else '0' }}">
        </div>
      </div>
      <div class="col-md-4">
        <div class="form-check mt-4">
          <input type="checkbox" class="form-check-input" id="is_active" name="is_active" value="1" {% if (section and section.is_active) or not section %}checked{% endif %}>
          <label class="form-check-label" for="is_active"><strong>Active</strong></label>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="btn-group-custom">
    <button type="submit" class="btn btn-primary btn-lg">
      <i class="fas fa-save"></i> Save Section
    </button>
    <a href="/admin/pages/{{ page.id }}/sections" class="btn btn-secondary btn-lg">
      <i class="fas fa-arrow-left"></i> Back
    </a>
  </div>
</form>

<script>
  function updateTypeFields() {
    const type = document.getElementById('sectionType').value;
    const heroFields = document.getElementById('heroFields');
    
    if (type === 'HERO') {
      heroFields.style.display = 'block';
    } else {
      heroFields.style.display = 'none';
    }
  }
  
  function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
      // Check file size (max 15MB)
      if (file.size > 15 * 1024 * 1024) {
        alert('File is too large. Maximum size is 15MB.');
        event.target.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const preview = document.getElementById('imagePreview');
        preview.innerHTML = '<div style="margin-top: 1rem;"><small class="text-muted">New image preview:</small><br><img src="' + e.target.result + '" alt="Preview" class="image-preview" style="max-width: 300px; margin-top: 0.5rem; border-radius: 0.5rem; border: 1px solid #e5e7eb;"></div>';
      };
      reader.readAsDataURL(file);
    }
  }
  
  function previewHeroImage(event) {
    const file = event.target.files[0];
    if (file) {
      // Check file size (max 15MB)
      if (file.size > 15 * 1024 * 1024) {
        alert('File is too large. Maximum size is 15MB.');
        event.target.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const preview = document.getElementById('heroImagePreview');
        preview.innerHTML = '<div style="margin-top: 1rem;"><small class="text-muted">New image preview:</small><br><img src="' + e.target.result + '" alt="Preview" class="image-preview" style="max-width: 300px; margin-top: 0.5rem; border-radius: 0.5rem; border: 1px solid #e5e7eb;"></div>';
      };
      reader.readAsDataURL(file);
    }
  }
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    updateTypeFields();
  });
</script>

{% endblock %}

